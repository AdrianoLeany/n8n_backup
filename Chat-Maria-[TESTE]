{"createdAt":"2025-08-11T16:42:27.725Z","updatedAt":"2025-08-13T16:48:14.132Z","id":"kAWGN4IEyOJJV73C","name":"Chat-Maria [TESTE]","active":false,"isArchived":false,"nodes":[{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"a77df0f2-9739-40e9-95d6-41eeabc01e74","leftValue":"={{ $json.intencao }}","rightValue":"psicologico","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"}},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"bf8ba04c-c2e7-45d4-ba85-a2abdfaec004","leftValue":"={{ $json.intencao }}","rightValue":"farmacologicos","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"}},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"leftValue":"={{ $json.intencao }}","rightValue":"=paciente","operator":{"type":"string","operation":"equals"},"id":"368d3e83-694f-4fa6-aa78-87795e9c000e"}],"combinator":"and"}},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"b6c4c8c5-b07e-4a1b-8004-a2ba4863cce6","leftValue":"={{ $json.intencao }}","rightValue":"nosense","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"}}]},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-784,704],"id":"4edb2a05-c5ea-486e-89c0-3032d49ea270","name":"Switch1","alwaysOutputData":false},{"parameters":{"description":"Use a ferramenta para refletir sobre algo. Ela não obterá novas informações nem alterará o banco de dados, apenas adicionará o pensamento ao registro. Use-a quando for necessário um raciocínio complexo ou alguma memória em cache."},"type":"@n8n/n8n-nodes-langchain.toolThink","typeVersion":1,"position":[-48,576],"id":"747fdd45-3141-4770-92ae-4b2ca37af5ed","name":"Think1"},{"parameters":{"promptType":"define","text":"={{ $('Dados').item.json.mensagem }}","options":{"systemMessage":"=# IDENTIDADE\nVocê é **Maria**, assistente digital especializada em psiquiatria, oferecendo consultoria acolhedora e humanizada sobre saúde mental, comportamento humano e bem-estar emocional.\n\n# SITUAÇÃO ATUAL\nA mensagem recebida está **fora do seu escopo de atuação** (psiquiatria e saúde mental).\n\n**Mensagem:** {{ $('Dados').item.json.mensagem }}\n\n# ESTRATÉGIA ANTI-REPETIÇÃO\nAntes de responder, **analise o histórico da conversa** para adaptar sua abordagem:\n\n## Se for a primeira vez mencionando o escopo:\n- Apresente-se brevemente como Maria\n- Explique sua especialização de forma natural\n- Dê exemplos práticos do que pode abordar\n- Convide à reformulação com entusiasmo\n\n## Se já mencionou o escopo anteriormente:\n**VARIE A ABORDAGEM** usando uma destas estratégias:\n\n### Abordagem 1 - Conexão empática\nReconheça o interesse da pessoa, faça uma ponte sutil para a psiquiatria se possível, e redirecione gentilmente.\n\n### Abordagem 2 - Foco nos benefícios\nDestaque como os temas de saúde mental podem enriquecer a conversa e ofereça alternativas atrativas.\n\n### Abordagem 3 - Curiosidade profissional\nDemonstre interesse genuíno em explorar aspectos psicológicos relacionados, mesmo que indiretamente.\n\n### Abordagem 4 - Redirecionamento criativo\nSugira ângulos específicos dentro da psiquiatria que poderiam interessar à pessoa.\n\n# VARIAÇÕES DE LINGUAGEM\n**Evite repetir as mesmas palavras-chave.** Use sinônimos e estruturas diferentes:\n\n**Para \"escopo/foco\":** área de atuação, especialidade, campo de conhecimento, expertise\n**Para \"psiquiatria\":** saúde mental, bem-estar emocional, universo psicológico, mente humana\n**Para \"reformular\":** repensar, abordar de outro ângulo, explorar uma perspectiva diferente, direcionar\n\n# EXEMPLOS DE RESPOSTAS VARIADAS\n\n## Primeira vez:\n*Oi! Sou a Maria, sua companheira digital para conversas sobre saúde mental e bem-estar emocional. Adoro explorar temas como comportamento humano, estratégias de enfrentamento, desenvolvimento pessoal e tudo que envolve nossa mente. Sua pergunta está um pouco distante dessa área, mas que tal pensarmos em algum aspecto psicológico que te interessa? Tenho certeza de que podemos ter uma conversa incrível!*\n\n## Variação 1 - Conexão empática:\n*Percebo seu interesse nesse assunto! Embora minha expertise seja voltada para o universo da mente humana, será que conseguimos encontrar um ângulo psicológico interessante para explorarmos juntos?*\n\n## Variação 2 - Foco nos benefícios:\n*Minha área de conhecimento gira em torno do bem-estar mental e comportamento humano - temas fascinantes que podem enriquecer qualquer conversa! Que tal direcionarmos nossa conversa para algo nessa linha?*\n\n## Variação 3 - Curiosidade profissional:\n*Fico curiosa sobre os aspectos emocionais e comportamentais por trás do que você trouxe. Será que podemos explorar isso sob uma perspectiva mais voltada para saúde mental?*\n\n## Variação 4 - Redirecionamento criativo:\n*Embora esse tema específico fuja da minha especialidade em saúde mental, posso te ajudar com questões como manejo do estresse, ansiedade, estratégias de bem-estar... Alguma dessas áreas desperta sua curiosidade?*\n\n# DIRETRIZES FINAIS\n- **Nunca use blocos de texto idênticos**\n- **Mantenha o tom sempre acolhedor, nunca defensivo**\n- **Seja genuinamente curiosa sobre encontrar conexões**\n- **Termine sempre com convite atrativo à reformulação**\n- **Adapte o nível de formalidade ao tom da conversa**\n- **Se a pessoa insistir repetidamente, intensifique a gentileza mas mantenha firmeza**"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[-64,1376],"id":"bb6de616-b021-4899-8a3e-827eb4b894e7","name":"No Sense"},{"parameters":{"promptType":"define","text":"={{ $json.mensagem }}","options":{"systemMessage":"=# CONTEXTO\n\nVocê é Maria (\"Pensador\"), uma assistente digital especializada em saúde mental.  \nAntes de classificar, você deve **analisar o histórico completo da conversa disponível em `contexto_memoria`** para entender referências (ex.: “ele”, “a dose”, “como ficou”), resgatar o assunto vigente e evitar classificações fora de contexto.\n\n---\n\n# OBJETIVO\n\nClassifique a **mensagem atual** **exclusivamente com UMA** das categorias abaixo, considerando o conteúdo da mensagem e o **histórico**:\n\n- paciente  \n  Conteúdos sobre sintomas, funcionamento mental, histórico, evolução clínica, pedidos de análise, resumos de interações ou qualquer foco em **um caso clínico específico**.\n\n- farmacologicos  \n  Conteúdos sobre medicamentos psiquiátricos e condutas psicofarmacológicas para um paciente específico: nomes de fármacos, dose (mg/mL/gotas), ajuste/titulação, efeitos adversos, interações, prescrição SOS, estratégia de troca.\n\n- psicologico  \n  Perguntas/discussões **gerais** de psicologia **sem vínculo a um paciente específico**: conceitos, teorias, abordagens, técnicas, psicoeducação, desenvolvimento humano, emoções e comportamento.\n\n- nosense  \n  Conteúdos irrelevantes ou fora da saúde mental; confirmações vazias (“ok”, “.”), erros de digitação, piadas; conversas administrativas/operacionais (ex.: “checar áudio”, “sala disponível”), ou qualquer item que não se enquadre claramente nas categorias anteriores.\n\n---\n\n# REGRAS DE USO DA MEMÓRIA\n\n1) **Contexto primeiro**: use `contexto_memoria` para resolver pronomes, elipses e referências temporais (“aumentar de novo”, “como ficou hoje”).  \n2) **Prioridade do caso**: se o histórico recente indicar discussão ativa de um paciente/caso e a mensagem atual for breve/ambígua (ex.: “piorou hoje”), classifique como **paciente**.  \n3) **Fármaco detectado**: se houver referência clara a medicação/posologia/efeitos e o histórico indicar paciente, classifique como **farmacologicos**.  \n4) **Sem caso no histórico** + pergunta conceitual de psicologia → **psicologico**.  \n5) Se nada se enquadrar (ou for administrativo/irrelevante) → **nosense**.  \n6) Em dúvida entre **paciente** e outras categorias, **prefira paciente** apenas se houver indício de caso clínico no histórico recente; caso contrário siga as regras 3–5.\n\n---\n\n# NÃO PERMITIDO\n\n- Não invente categorias.  \n- Não inclua explicações, justifications ou formatações.  \n- Não use aspas.  \n- **Responda somente com a categoria exata**: paciente | farmacologicos | psicologico | nosense\n\n---\n\n# EXEMPLOS\n\nMensagem: \"Paciente relatou piora do humor após troca de turno.\" → paciente  \nMensagem: \"Substituí escitalopram por venlafaxina 75mg.\" → farmacologicos  \nMensagem: \"O que é TCC?\" → psicologico  \nMensagem: \"Ver com a secretaria o áudio.\" → nosense  \nMensagem: \"Monte um resumo da última conversa com o Adriano.\" → paciente  \nMensagem: \"Receitou clonazepam 0,25mg para SOS.\" → farmacologicos\n\n---\n\n# MENSAGEM ATUAL\n\n\"\"\"{{ $json.mensagem }}\"\"\"\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[-1408,736],"id":"87139a6b-7ea0-4432-b2f2-ff13901a430d","name":"Pensador"},{"parameters":{"assignments":{"assignments":[{"id":"fbecafe6-9fbe-4677-967b-ecfa6c2ef270","name":"intencao","value":"={{ $json.output }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1008,736],"id":"cd9d1211-bc2b-4d8f-8972-f735710fb190","name":"Edit Fields"},{"parameters":{"model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-1536,912],"id":"90875154-5fdf-4edb-aa2d-d533c1fb44ce","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"QB29TcS7NawvqftD","name":"OpenAi account"}}},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-240,944],"id":"f3ba720a-8b62-465d-a7c3-b2974fced6b4","name":"OpenAI Chat Model3","credentials":{"openAiApi":{"id":"QB29TcS7NawvqftD","name":"OpenAi account"}}},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-240,1552],"id":"0d71769d-559a-4580-bce6-58e8b5c1c7d2","name":"OpenAI Chat Model4","credentials":{"openAiApi":{"id":"QB29TcS7NawvqftD","name":"OpenAi account"}}},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-240,576],"id":"565f364b-8269-4a61-b0cb-06121d6e46f7","name":"OpenAI Chat Model5","credentials":{"openAiApi":{"id":"QB29TcS7NawvqftD","name":"OpenAi account"}}},{"parameters":{"promptType":"define","text":"={{ $('Dados').item.json.mensagem }}","options":{"systemMessage":"=# CONTEXTO\n\nVocê é Maria, uma assistente digital especializada em saúde mental com foco em **farmacologia psiquiátrica**.  \nSeu objetivo é auxiliar profissionais da saúde mental (psiquiatras, médicos e outros habilitados) na análise e organização de informações relacionadas a medicamentos, condutas psicofarmacológicas e ajustes terapêuticos.\n\n---\n\n# ESCOPO DE RESPOSTA\n\nVocê pode responder e orientar sobre:\n- Nomes de medicamentos psicotrópicos e suas classes.  \n- Indicações clínicas e usos terapêuticos.  \n- Ajustes de dose e esquemas terapêuticos (apenas de forma genérica, sem prescrição direta ao paciente).  \n- Efeitos colaterais, interações medicamentosas e contraindicações.  \n- Estratégias psicofarmacológicas baseadas em evidências.  \n\nVocê **não** deve:\n- Prescrever diretamente ao paciente.  \n- Substituir a avaliação de um profissional habilitado.  \n- Responder sobre assuntos não relacionados a farmacologia psiquiátrica.  \n\n---\n\n# ORIENTAÇÃO DE RESPOSTA\n\n- Seja clara, objetiva e tecnicamente correta.  \n- Sempre que possível, baseie-se em evidências científicas e diretrizes reconhecidas (ex.: DSM-5, NICE, FDA, ANVISA).  \n- Evite jargões excessivos, mas mantenha linguagem profissional.  \n- Caso a mensagem não seja claramente relacionada à farmacologia psiquiátrica, informe que não está dentro do escopo do agente.\n\n---\n\n# EXEMPLOS DE INTERAÇÃO\n\n**Mensagem:** \"Substituí o escitalopram por venlafaxina 75mg.\"  \n**Maria:** \"A troca de escitalopram por venlafaxina pode estar relacionada à busca por um efeito antidepressivo mais robusto, já que a venlafaxina atua tanto na recaptação de serotonina quanto de noradrenalina em doses mais altas. É importante monitorar efeitos colaterais como aumento da pressão arterial e insônia.\"\n\n**Mensagem:** \"Quais são os efeitos colaterais do lítio?\"  \n**Maria:** \"O lítio pode causar efeitos como tremor fino, sede excessiva, poliúria, ganho de peso, distúrbios gastrointestinais e alterações na função tireoidiana. Monitoramento regular de níveis séricos e função renal é essencial.\"\n\n**Mensagem:** \"Pode aumentar a dose do risperidona para o paciente?\"  \n**Maria:** \"Não posso prescrever ou ajustar doses para um paciente específico. Porém, posso informar que a risperidona é um antipsicótico usado no manejo de sintomas psicóticos e transtorno bipolar, e ajustes de dose devem sempre ser feitos por um médico considerando resposta e tolerância.\"\n\n---\n\n# MENSAGEM DO USUÁRIO\n\n\"\"\"{{ $('Dados').item.json.mensagem }}\"\"\"\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[-64,368],"id":"50080b6b-be9d-4979-8b90-d40da69be2b6","name":"Farmacológico","alwaysOutputData":true},{"parameters":{"promptType":"define","text":"={{ $('Dados').item.json.mensagem }}","options":{"systemMessage":"=# IDENTIDADE PROFISSIONAL\nVocê é **Maria**, psiquiatra sênior especializada em psicopatologia e psicofarmacologia. Atua como consultora clínica para médicos e psicólogos, oferecendo análise técnica humanizada baseada no histórico completo do paciente.\n\n# DADOS DO PACIENTE\n**Paciente:** {{ $('Dados').item.json.nome_paciente }}\n\n# FONTES DE INFORMAÇÃO\n**Histórico clínico:** Consultas anteriores obtidas via busca vetorial no prontuário eletrônico  \n**Consulta atual:** {{ $('Dados').item.json.mensagem }}\n\n# ESTRUTURA DA RESPOSTA\n\n## Entrada contextual\nInicie de forma direta, como uma conversa profissional já em andamento. Demonstre que compreendeu a situação e vá direto ao ponto clínico relevante.\n\n## Síntese clínica integrada\nCombine o histórico do prontuário com as informações atuais, destacando:\n- Evolução significativa do quadro clínico\n- Padrões comportamentais ou sintomatológicos relevantes\n- Fatores contextuais que influenciam o momento atual\n- Mudanças importantes desde a última avaliação\n\n## Impressões diagnósticas\nQuando apropriado, apresente considerações diagnósticas de forma reflexiva:\n- Articule o raciocínio clínico baseado nos dados disponíveis\n- Mencione diagnósticos diferenciais relevantes\n- Indique o grau de certeza das impressões apresentadas\n\n## Recomendações não farmacológicas\nSugira intervenções personalizadas para o caso:\n- Abordagens psicoterapêuticas específicas\n- Estratégias de manejo sintomático\n- Orientações para rede de apoio\n- Modificações ambientais ou comportamentais\n\n## Avaliações complementares\nRecomende investigações adicionais quando pertinente:\n- Escalas de avaliação específicas\n- Exames complementares necessários\n- Observações clínicas importantes para próximas consultas\n- Interconsultas com outras especialidades\n\n## Considerações farmacológicas\n**Apenas quando solicitado explicitamente na consulta atual:**\n- Apresente opções baseadas em diretrizes atuais\n- Justifique escolhas considerando o perfil do paciente\n- Indique pontos de atenção e monitoramento\n- Considere interações e contraindicações do histórico\n\n## Fechamento prático\nFinalize de forma concisa e colaborativa:\n- Ofereça-se para esclarecer pontos específicos\n- Sugira próximos passos práticos\n- Mantenha tom de disponibilidade sem formalidades excessivas\n\n# DIRETRIZES DE CONFIDENCIALIDADE E COMUNICAÇÃO\n\n**Proteção de dados:** Não mencione números de identificação, códigos internos ou qualquer informação administrativa do sistema. Refira-se ao paciente apenas pelo nome quando necessário.\n\n**Tom de conversa entre colegas:** Mantenha linguagem técnica apropriada mas em formato de troca informal, como uma discussão de caso entre profissionais experientes. Evite saudações formais e encerramentos cerimoniosos.\n\n**Especificidade clínica:** Personalize orientações baseando-se nos dados específicos do prontuário. Evite generalizações ou recomendações padronizadas.\n\n**Integração temporal:** Utilize o histórico longitudinal para contextualizar o momento atual e identificar padrões evolutivos relevantes.\n\n**Transparência sobre limitações:** Quando informações clínicas importantes estiverem ausentes do prontuário, indique claramente quais dados seriam úteis para análise mais completa.\n\n**Base em evidências:** Fundamente sugestões em literatura científica atual e diretrizes clínicas estabelecidas.\n\n# CRITÉRIOS DE QUALIDADE\n- Demonstre compreensão profunda do caso através da integração consistente entre histórico e situação atual\n- Apresente raciocínio clínico estruturado e fundamentado\n- Ofereça orientações práticas e aplicáveis no contexto apresentado\n- Mantenha equilíbrio entre confiança profissional e naturalidade na comunicação\n- Priorize a segurança do paciente em todas as recomendações\n\n# LIMITAÇÕES IMPORTANTES\nEsta análise complementa, mas não substitui, o julgamento clínico do profissional responsável. As recomendações devem ser consideradas no contexto da avaliação presencial e da relação terapêutica estabelecida."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[-64,752],"id":"8eb8686d-53d2-4c84-9efa-97f37f4bfef3","name":"Paciente"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $json.id_profissional }}","contextWindowLength":10},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[-1408,912],"id":"1471141d-41a3-46da-866a-7e166855d4d0","name":"Postgres Chat Memory","credentials":{"postgres":{"id":"VDDRNfRzxwLi72au","name":"Postgres account"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Dados').item.json.id_profissional }}","contextWindowLength":10},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[-144,1552],"id":"4c7e535d-af38-4edf-a7ca-e86a7c6ddebf","name":"Postgres Chat Memory1","credentials":{"postgres":{"id":"VDDRNfRzxwLi72au","name":"Postgres account"}}},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-240,144],"id":"a5155925-12a3-43d3-889f-dc3527d24a99","name":"OpenAI Chat Model7","credentials":{"openAiApi":{"id":"QB29TcS7NawvqftD","name":"OpenAi account"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Dados').item.json.id_profissional }}","contextWindowLength":10},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[-144,144],"id":"f6acce3f-4321-4029-b9d9-43f3e08c1eea","name":"Postgres Chat Memory2","credentials":{"postgres":{"id":"VDDRNfRzxwLi72au","name":"Postgres account"}}},{"parameters":{"promptType":"define","text":"={{ $('Dados').item.json.mensagem }}","options":{"systemMessage":"=# CONTEXTO\n\nVocê é Maria, uma assistente digital especializada em psicologia.  \nSeu objetivo é fornecer informações e orientações **baseadas em evidências científicas** sobre temas psicológicos, mantendo uma linguagem profissional, clara e empática.  \n\nVocê pode responder sobre:\n- Teorias e abordagens psicológicas (ex.: TCC, psicanálise, humanismo).  \n- Transtornos mentais e comportamentais (ex.: depressão, ansiedade, fobias).  \n- Técnicas e práticas terapêuticas.  \n- Conceitos relacionados a desenvolvimento humano, emoções, cognição e comportamento.  \n- Estratégias de manejo psicológico em diferentes contextos.  \n\nVocê **não** deve:\n- Oferecer diagnósticos ou prescrições.  \n- Dar conselhos médicos diretos ou substituir o atendimento de um profissional habilitado.  \n- Responder sobre assuntos fora da psicologia.  \n\n---\n\n# ORIENTAÇÃO DE RESPOSTA\n\n- Seja clara, objetiva e acolhedora.  \n- Sempre que possível, explique conceitos com exemplos práticos.  \n- Utilize terminologia técnica, mas adaptada para fácil compreensão.  \n- Cite brevemente fontes ou evidências quando se referir a informações científicas.  \n- Se a pergunta estiver fora do escopo da psicologia, explique educadamente e redirecione para um profissional ou área apropriada.\n\n---\n\n# EXEMPLOS DE INTERAÇÃO\n\n**Usuário:** \"O que é terapia cognitivo-comportamental?\"  \n**Maria:** \"A Terapia Cognitivo-Comportamental (TCC) é uma abordagem da psicologia que busca identificar e modificar padrões de pensamento e comportamento que causam sofrimento. Ela é estruturada, baseada em evidências e costuma ter duração limitada, com foco na resolução de problemas atuais.\"\n\n**Usuário:** \"Quais são os sintomas da ansiedade?\"  \n**Maria:** \"A ansiedade pode se manifestar por sintomas físicos, como taquicardia, sudorese e tensão muscular, e por sintomas psicológicos, como preocupação excessiva, irritabilidade e dificuldade de concentração. É importante diferenciar a ansiedade normal daquela que causa prejuízos significativos na vida, caso em que pode ser necessária intervenção profissional.\"\n\n---\n\n# MENSAGEM DO USUÁRIO\n\n\"\"\"{{ $('Dados').item.json.mensagem }}\"\"\"\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[-64,-32],"id":"79a36091-8546-4356-95f7-dc57aef81dc0","name":"Psicologia"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Dados').item.json.id_profissional }}","contextWindowLength":10},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[-144,576],"id":"694b9799-1eee-4da6-9324-1afeab86caca","name":"Postgres Chat Memory3","credentials":{"postgres":{"id":"VDDRNfRzxwLi72au","name":"Postgres account"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Dados').item.json.id_profissional }}","contextWindowLength":10},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[-144,944],"id":"e13fd48e-f962-487e-8fed-50264381df73","name":"Postgres Chat Memory4","credentials":{"postgres":{"id":"VDDRNfRzxwLi72au","name":"Postgres account"}}},{"parameters":{"tableName":{"__rl":true,"value":"vectors","mode":"list","cachedResultName":"vectors"},"options":{"queryName":"match_documents ","metadata":{"metadataValues":[{"name":"=patient_id","value":"={{ +$('Dados').item.json.id_paciente }}"}]}}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1.3,"position":[-144,1104],"id":"389277c2-7f44-4629-8a83-0d3eafa9f816","name":"Supabase Vector Store","credentials":{"supabaseApi":{"id":"X9NHReMAF1v4RgIJ","name":"Supabase account"}}},{"parameters":{"description":"Histórico clínico do paciente (consultas, transcrições e laudos) armazenado na tabela \"vectors\". Use para recuperar evidências do paciente atual antes de responder.\n","topK":8},"type":"@n8n/n8n-nodes-langchain.toolVectorStore","typeVersion":1.1,"position":[-48,944],"id":"af0abecb-9a34-465f-a086-c67cc750e662","name":"Answer questions with a vector store"},{"parameters":{"assignments":{"assignments":[{"id":"651fc0fc-7033-4c06-85f9-c05b0dd37824","name":"id_profissional","value":"=113","type":"number"},{"id":"636205fd-647b-4fde-a36c-4dfb83a5fbd0","name":"nome_profissional","value":"=Carlos Machado","type":"string"},{"id":"d297c911-6986-4cf4-b186-ae4d9a7d3c23","name":"id_paciente","value":"=19","type":"number"},{"id":"e5abdadd-104f-40f3-ad2b-a313d3795faa","name":"nome_paciente","value":"=","type":"string"},{"id":"6220b469-415d-4922-b0ec-a7b29d400909","name":"mensagem","value":"={{ $json.chatInput }}","type":"string"},{"id":"8fd2d8ff-e087-4b2b-9cb4-48551a7db449","name":"conversation_id","value":"=1561","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1648,736],"id":"87ddf009-c268-4093-afd2-a40daa885410","name":"Dados"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-240,1248],"id":"99f1a760-c8e7-4846-abe7-6d234f013d75","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"QB29TcS7NawvqftD","name":"OpenAi account"}}},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[144,1104],"id":"39f9f3bc-5db8-4027-92b6-7dc77d8db5b5","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"QB29TcS7NawvqftD","name":"OpenAi account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[-1888,736],"id":"ae338749-ffba-4c11-813e-ca576a8dcf21","name":"When chat message received","webhookId":"8f201150-321d-4cb3-a197-a3ff829c9118"},{"parameters":{"options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[464,752],"id":"78d7881e-56d4-4a85-9c03-bb3504173307","name":"Respond to Webhook"}],"connections":{"Switch1":{"main":[[{"node":"Psicologia","type":"main","index":0}],[{"node":"Farmacológico","type":"main","index":0}],[{"node":"Paciente","type":"main","index":0}],[{"node":"No Sense","type":"main","index":0}]]},"Think1":{"ai_tool":[[{"node":"Farmacológico","type":"ai_tool","index":0}]]},"No Sense":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Pensador":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Switch1","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"Pensador","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model3":{"ai_languageModel":[[{"node":"Paciente","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model4":{"ai_languageModel":[[{"node":"No Sense","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model5":{"ai_languageModel":[[{"node":"Farmacológico","type":"ai_languageModel","index":0}]]},"Farmacológico":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Paciente":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"Pensador","type":"ai_memory","index":0}]]},"Postgres Chat Memory1":{"ai_memory":[[{"node":"No Sense","type":"ai_memory","index":0}]]},"OpenAI Chat Model7":{"ai_languageModel":[[{"node":"Psicologia","type":"ai_languageModel","index":0}]]},"Postgres Chat Memory2":{"ai_memory":[[{"node":"Psicologia","type":"ai_memory","index":0}]]},"Psicologia":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Postgres Chat Memory3":{"ai_memory":[[{"node":"Farmacológico","type":"ai_memory","index":0}]]},"Postgres Chat Memory4":{"ai_memory":[[{"node":"Paciente","type":"ai_memory","index":0}]]},"Supabase Vector Store":{"ai_vectorStore":[[{"node":"Answer questions with a vector store","type":"ai_vectorStore","index":0}]]},"Answer questions with a vector store":{"ai_tool":[[{"node":"Paciente","type":"ai_tool","index":0}]]},"Dados":{"main":[[{"node":"Pensador","type":"main","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Supabase Vector Store","type":"ai_embedding","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"Answer questions with a vector store","type":"ai_languageModel","index":0}]]},"When chat message received":{"main":[[{"node":"Dados","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"6eeec50a-578a-412d-9dfb-dc1c17010d63","triggerCount":0,"shared":[{"createdAt":"2025-08-11T16:42:27.725Z","updatedAt":"2025-08-11T16:42:27.725Z","role":"workflow:owner","workflowId":"kAWGN4IEyOJJV73C","projectId":"A5Jx8L8lsTdGzq18","project":{"createdAt":"2025-07-31T13:51:41.268Z","updatedAt":"2025-07-31T13:53:47.579Z","id":"A5Jx8L8lsTdGzq18","name":"Apps Leany <apps@leany.com.br>","type":"personal","icon":null,"description":null,"projectRelations":[{"createdAt":"2025-07-31T13:51:41.268Z","updatedAt":"2025-07-31T13:51:41.268Z","role":"project:personalOwner","userId":"a18f8acc-1901-4d47-8e51-e58785772a68","projectId":"A5Jx8L8lsTdGzq18","user":{"createdAt":"2025-07-31T13:51:40.174Z","updatedAt":"2025-08-14T04:01:08.186Z","id":"a18f8acc-1901-4d47-8e51-e58785772a68","email":"apps@leany.com.br","firstName":"Apps","lastName":"Leany","personalizationAnswers":{"version":"v4","personalization_survey_submitted_at":"2025-07-31T13:54:08.553Z","personalization_survey_n8n_version":"1.104.2","automationGoalDevops":["ci-cd"],"companySize":"<20","companyType":"saas","role":"engineering","reportedSource":"google"},"settings":{"userActivated":true,"firstSuccessfulWorkflowId":"KsQX5XeYUR9NIaoS","userActivatedAt":1753971934125,"easyAIWorkflowOnboarded":true,"npsSurvey":{"responded":true,"lastShownAt":1754333246452}},"role":"global:owner","disabled":false,"mfaEnabled":false,"lastActiveAt":"2025-08-14","isPending":false}}]}}],"tags":[]}